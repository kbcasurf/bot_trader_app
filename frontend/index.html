<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Bot</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.svg">
    <meta name="description" content="Automated cryptocurrency trading bot for Binance">
    <!-- Prevent favicon.ico requests -->
    <link rel="icon" href="data:,">
</head>
<body data-initialized="false">
    <!-- System status banner container -->
    <div id="system-status-banner" class="status-banner" style="display: none;">
        <span id="status-message">System status loading...</span>
        <button class="close-banner">&times;</button>
    </div>

    <!-- Application loader -->
    <div id="app-loader" class="app-loader">
        <div class="loader-spinner"></div>
        <p>Loading Crypto Trading Bot...</p>
    </div>

    <div id="app-container" class="app-container" style="display: none;">
        <header>
            <div class="header-content">
                <img src="/images/btc.svg" alt="Bitcoin" class="header-icon">
                <div class="header-text">
                    <h1>Crypto Trading Bot</h1>
                    <p>Automatically trade crypto for profit</p>
                </div>
            </div>
            
            <!-- Theme Switch -->
            <div class="theme-switch-container">
                <span class="theme-icon">‚òÄÔ∏è</span>
                <label class="theme-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
                <span class="theme-icon">üåô</span>
            </div>
        </header>

        <div class="crypto-grid" data-module="cards">
            <!-- Cryptocurrency cards will be dynamically inserted here -->
        </div>
        
        <div class="status-section" data-module="monitor">
            <div class="status-card" id="connection-status">
                <h3>Connection Status</h3>
                <div class="status-indicator">
                    <div class="status-dot" id="backend-status-dot"></div>
                    <span id="backend-status-text">Backend: Connecting...</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="db-status-dot"></div>
                    <span id="db-status-text">Database: Connecting...</span>
                </div>
            </div>
            <div class="status-card" id="api-status">
                <h3>API Status</h3>
                <div class="status-indicator">
                    <div class="status-dot" id="binance-status-dot"></div>
                    <span id="binance-status-text">Binance: Connecting...</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="telegram-status-dot"></div>
                    <span id="telegram-status-text">Telegram: Connecting...</span>
                </div>
            </div>
        </div>

        <!-- WebSocket monitor -->
        <div id="websocket-monitor" class="websocket-monitor" data-module="monitor">
            <span class="status-label">WebSocket Status: </span>
            <span class="status-value" id="ws-connection-status">Unknown</span>
        </div>

        <!-- Development tools (hidden in production) -->
        <div id="dev-tools" class="test-actions" style="display: none;" data-env="development">
            <h3>Development Tools</h3>
            <div class="test-buttons">
                <button id="test-connection">Test Connection</button>
                <button id="test-websocket">Test Binance WebSocket</button>
                <button id="refresh-data">Refresh All Data</button>
                <button id="toggle-debug">Toggle Debug Info</button>
            </div>
        </div>

        <!-- Debug info panel (hidden by default) -->
        <div id="debug-panel" class="debug-panel" style="display: none;" data-env="development">
            <h3>Debug Information</h3>
            <div id="debug-content" class="debug-content"></div>
        </div>
    </div>

    <!-- Error container (for initialization errors) -->
    <div id="error-container" class="error-container" style="display: none;">
        <div class="error-content">
            <h2>Initialization Error</h2>
            <p id="error-message">There was a problem loading the application.</p>
            <button id="retry-button">Retry</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Cryptocurrency Trading Bot &copy; 2025 | <a href="#" id="show-disclaimer">Disclaimer</a></p>
    </footer>

    <!-- Disclaimer modal -->
    <div id="disclaimer-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Trading Disclaimer</h2>
            <p>Cryptocurrency trading involves significant risk. This application is for educational purposes only and not financial advice. Past performance is not indicative of future results. Always invest only what you can afford to lose.</p>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Module and polyfill for older browsers -->
    <script nomodule src="https://unpkg.com/es-module-shims@1.5.1/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "socket.io-client": "https://cdn.socket.io/4.7.2/socket.io.esm.min.js"
        }
    }
    </script>
    
    <!-- Main script (entry point) -->
    <script type="module" src="./main.js"></script>

    <!-- Inline script for initial UI state -->
    <script>
        // Show the appropriate UI elements based on loading status
        document.addEventListener('DOMContentLoaded', function() {
            // Check if running in development environment
            const isDevMode = window.location.hostname === 'localhost' || 
                              window.location.hostname === '127.0.0.1';
            
            // Show dev tools in development mode
            if (isDevMode) {
                document.getElementById('dev-tools').style.display = 'block';
                document.querySelectorAll('[data-env="development"]').forEach(el => {
                    el.style.display = 'block';
                });
            }
            
            // Handle status banner close button
            document.querySelector('.close-banner').addEventListener('click', function() {
                document.getElementById('system-status-banner').style.display = 'none';
            });
            
            // Show disclaimer modal
            document.getElementById('show-disclaimer').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('disclaimer-modal').style.display = 'block';
            });
            
            // Close modal on X click
            document.querySelector('.close-modal').addEventListener('click', function() {
                document.getElementById('disclaimer-modal').style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('disclaimer-modal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Retry button
            document.getElementById('retry-button').addEventListener('click', function() {
                window.location.reload();
            });
        });
        
        // Function to handle initialization completion
        window.appInitialized = function() {
            document.body.setAttribute('data-initialized', 'true');
            document.getElementById('app-loader').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
        };
        
        // Function to handle initialization failure
        window.appInitializationFailed = function(message) {
            document.getElementById('app-loader').style.display = 'none';
            document.getElementById('error-container').style.display = 'flex';
            document.getElementById('error-message').textContent = message || 
                'There was a problem loading the application. Please try again.';
        };
    </script>
</body>
</html>